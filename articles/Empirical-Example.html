<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Empirical Example from Grabowski (2024) Walkthrough • blouch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Example from Grabowski (2024) Walkthrough">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blouch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Empirical-Example.html">Empirical Example from Grabowski (2024)</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation-Example.html">Simulation Example from Grabowski (2024)</a></li>
    <li><a class="dropdown-item" href="../articles/Basic_Models-Examples.html">Basic Models</a></li>
    <li><a class="dropdown-item" href="../articles/Multi-optima_Models-Examples.html">Multi-Optima Models</a></li>
    <li><a class="dropdown-item" href="../articles/Varying_Effects_Models-Examples.html">Varying Effects Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mark-grabowski/blouch"><span class="fa fa-brands fa-github"></span> Github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Empirical Example from Grabowski (2024) Walkthrough</h1>
                        <h4 data-toc-skip class="author">Mark
Grabowski</h4>
            
            <h4 data-toc-skip class="date">2025-10-13</h4>
      

      <div class="d-none name"><code>Empirical-Example.Rmd</code></div>
    </div>

    
    
<p>This example presents the basic and advanced options of
<em>Blouch</em> and the code below is the complete analysis of the
empirical example from Grabowski (in press) on antler size and breeding
group evolution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mark-grabowski.github.io/blouch/">blouch</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Tsuboi et al. (2024) collected an expansive dataset on antler size
and body size and generated a new Cervidae phylogeny to test the
hypothesis of Gould (1973) that the elaborate antlers of the Irish Elk
were the result of a positive allometric relationship with body size. I
supplemented this dataset with data on Cervidae breeding group size
categories from Plard et al. (2011) and Clutton-Brock et al. (1980) to
test the hypothesis that antler size is influenced by sexual selection
by using breeding group size as a predictor of antler size.</p>
<p>As formulated by Clutton-Brock et al. (1980), the specific hypothesis
is that the relatively larger antlers of larger bodied deer are the
result of more intense sexual selection that comes along with their
tendency to live in larger breeding groups. Following Tsuboi et
al. (2024) the relationship between posterior skull length and antler
volume is hypothesized to be allometric and thus the direct effect model
is a reasonable choice. Following Hansen (2014), as sexual selection
would likely not cause an immediate change in either body size or antler
volume, the multi-optima model is indicated.</p>
<p>The hypothesized causal relationship between these three variables is
shown in the directed acyclic graph (DAG) below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">ggdag</span><span class="fu">::</span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span><span class="op">&lt;-</span><span class="fu">ggdag</span><span class="fu">::</span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag.html" class="external-link">ggdag</a></span><span class="op">(</span><span class="fu">ggdag</span><span class="fu">::</span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html" class="external-link">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">B</span>,</span>
<span>  <span class="va">P</span> <span class="op">~</span> <span class="va">B</span>,</span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">P</span>,</span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">u</span>,</span>
<span>  <span class="va">B</span> <span class="op">~</span> <span class="va">u</span>,</span>
<span>  <span class="va">P</span> <span class="op">~</span> <span class="va">u</span>,</span>
<span>  <span class="va">u</span> <span class="op">~</span> <span class="va">R</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p><em>Blouch</em> uses RStan to implement Stan. The following code
enables some compiler optimizations to improve the estimation speed of
the model, and is taken from: <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link uri">https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#options(mc.cores = parallel::detectCores())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#2 For R package checks - use line above on your own machine</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html" class="external-link">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dotR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"HOME"</span><span class="op">)</span>, <span class="st">".R"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">dotR</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dotR</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dotR</span>, <span class="st">"Makevars"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span>
<span><span class="va">arch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">R.version</span><span class="op">$</span><span class="va">arch</span> <span class="op">==</span> <span class="st">"aarch64"</span>, <span class="st">"arm64"</span>, <span class="st">"x86_64"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"\nCXX14FLAGS += -O3 -mtune=native -arch"</span>, <span class="va">arch</span>, <span class="st">"-ftemplate-depth-256"</span><span class="op">)</span>,</span>
<span>    file <span class="op">=</span> <span class="va">M</span>, sep <span class="op">=</span> <span class="st">"\n"</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-datasets">Load datasets<a class="anchor" aria-label="anchor" href="#load-datasets"></a>
</h2>
<p>First, load the tree from Tsuboi et al. (2024) and the dataset.
Original ata from Tsuboi et al. (2024) is available at DRYAD: <a href="https://doi.org/10.5061/dryad.kh18932dt" class="external-link uri">https://doi.org/10.5061/dryad.kh18932dt</a>, and dataset
including breeding group regims is included in the <em>Blouch</em>
package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co">########################################################################################################</span></span>
<span><span class="co">#For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html" class="external-link">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">########################################################################################################</span></span>
<span></span>
<span><span class="co">#Remove Muntiacus_atherodes, Elaphodus_cephalophus - rudamentary and female Rangifer - following Tsuboi et al. (2024)</span></span>
<span><span class="va">antler.data</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">antler.data</span>,<span class="va">Genus_Species</span> <span class="op">!=</span> <span class="st">"Sinomegaloceros_yabei"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span><span class="st">"Alces_alces_gigas"</span>  <span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span> <span class="st">"Muntiacus_truongsonensis"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span>  <span class="st">"Mazama_temama"</span><span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span>  <span class="st">"Muntiacus_feae"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span>  <span class="st">"Muntiacus_atherodes"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">Genus_Species</span> <span class="op">==</span>  <span class="st">"Elaphodus_cephalophus"</span><span class="op">)</span></span></code></pre></div>
<div id="section" class="section level108">
<p class="heading"></p>
</div>
</div>
<div class="section level2">
<h2 id="combine-data-and-tree-and-paint-regimes-on-tree-">Combine data and tree and paint regimes on tree.<a class="anchor" aria-label="anchor" href="#combine-data-and-tree-and-paint-regimes-on-tree-"></a>
</h2>
<p>Next we will use the <em>treeplyr</em> package (Uyeda and Harmon,
2014) make.treedata function to combine the data and tree based on the
taxa names. See <a href="https://github.com/uyedaj/treeplyr" class="external-link uri">https://github.com/uyedaj/treeplyr</a> for more on this
package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cervid.trdata</span> <span class="op">&lt;-</span> <span class="fu">treeplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/treeplyr/man/make.treedata.html" class="external-link">make.treedata</a></span><span class="op">(</span><span class="va">cervidae.tree</span>, <span class="va">antler.data</span>,name_column<span class="op">=</span><span class="st">"Genus_Species"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cervid.trdata</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cervid.trdata</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">log_ant_vol</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">log_psl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#cervid.trdata&lt;-dplyr::mutate(cervid.trdata,mc.log_psl=cervid.trdata$dat$log_psl-(mean(cervid.trdata$dat$log_psl)))</span></span>
<span></span>
<span><span class="va">cervid.trdata</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">cervid.trdata</span>,me.log_ant_vol<span class="op">=</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_vol_var_est</span><span class="op">/</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">cervid.trdata</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">cervid.trdata</span>,me.log_psl<span class="op">=</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_psl_var_est</span><span class="op">/</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">cervid.trdata</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cervid.trdata</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">me.log_ant_vol</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">me.log_psl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Mean standardize predictor</span></span>
<span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">mc_log_psl</span><span class="op">&lt;-</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_psl</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_psl</span><span class="op">)</span></span>
<span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">mc_log_ant_vol</span><span class="op">&lt;-</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_ant_vol</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cervid.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">log_ant_vol</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Main text analysis adding in BGS effect as adaptive predictor</span></span>
<span><span class="co">########################################################################################################</span></span>
<span><span class="va">cervid.trdata.BGS</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cervid.trdata</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">BGS</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Rescale tree height to 1</span></span>
<span><span class="va">l.tree</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/branching.times.html" class="external-link">branching.times</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">/</span><span class="va">l.tree</span> <span class="co">## rescale tree to height 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/branching.times.html" class="external-link">branching.times</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">tip.label</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span></span>
<span><span class="va">phy</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span></span>
<span><span class="co">#Dmat&lt;-cophenetic(phy) #Time separating tips, same as tij matrix in Slouch/Blouch code</span></span></code></pre></div>
<p>Next we will reconstruct the breeding group size regimes on the
phylogeny using the ace function from the R package ape. Then we will
calculate the most likely regime at each node using maximum likelihood
estimation (Pagel 1994) and add these to the internal nodes of our
phylogeny. We will use the equal-rates model (ER), the all-rates
different model (ARD), and the symmetrical model (SYM), and then compare
them using AICc.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Regime reconstruction using ace from ape</span></span>
<span><span class="va">reconstructed.BGS.ER</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ace.html" class="external-link">ace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span>, <span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span>, type <span class="op">=</span> <span class="st">"d"</span>, model<span class="op">=</span><span class="st">"ER"</span><span class="op">)</span></span>
<span><span class="va">reconstructed.BGS.ARD</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ace.html" class="external-link">ace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span>, <span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span>, type <span class="op">=</span> <span class="st">"d"</span>, model<span class="op">=</span><span class="st">"ARD"</span><span class="op">)</span></span>
<span><span class="va">reconstructed.BGS.SYM</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ace.html" class="external-link">ace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span>, <span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span>, type <span class="op">=</span> <span class="st">"d"</span>, model<span class="op">=</span><span class="st">"SYM"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">reconstructed.BGS.ER</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61.86089</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">reconstructed.BGS.ARD</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 71.36351</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">reconstructed.BGS.SYM</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 65.36549</span></span>
<span></span>
<span><span class="co">#The lowest AIC is for the equal rates model so we will use that in our analysis</span></span>
<span><span class="va">reconstructed.BGS</span><span class="op">&lt;-</span><span class="va">reconstructed.BGS.ER</span></span>
<span></span>
<span><span class="va">internal.regimes.BGS</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">reconstructed.BGS</span><span class="op">$</span><span class="va">lik.anc</span>, </span>
<span>                                     <span class="fl">1</span>, </span>
<span>                                     <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">reconstructed.BGS</span><span class="op">$</span><span class="va">lik.anc</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Assign internal regimes to node.label on phylogeny - for use by Blouch prep functions</span></span>
<span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">node.label</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">internal.regimes.BGS</span><span class="op">)</span></span></code></pre></div>
<p>Now lets check if these regime placements make sense</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Check if manual setting code worked - not needed for setting regimes</span></span>
<span><span class="va">shifts.total</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">internal.regimes.BGS</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edge.regimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">shifts.total</span><span class="op">[</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">edge.regimes</span><span class="op">)</span></span>
<span><span class="co">#&gt; 32 33    34 35 36 37 38    39 40                41    42          43       44 </span></span>
<span><span class="co">#&gt;  B  B  B  B  B  B  B  B  B  B  B  C  B  A  B  A  B  A  B  B  B  C  B  B  B  C </span></span>
<span><span class="co">#&gt; 45 46 47    48          49 50 51 52 53    54          55       56          57 </span></span>
<span><span class="co">#&gt;  C  C  C  C  C  A  C  C  C  C  C  C  C  C  C  C  B  C  C  C  B  C  C  C  C  A </span></span>
<span><span class="co">#&gt;    58 59          </span></span>
<span><span class="co">#&gt;  A  A  A  A  A  A </span></span>
<span><span class="co">#&gt; Levels: A B C</span></span>
<span></span>
<span><span class="va">reg.colors</span><span class="op">&lt;-</span><span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html" class="external-link">pal_aaas</a></span><span class="op">(</span><span class="st">"default"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">edge.regimes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span>,edge.color <span class="op">=</span> <span class="va">reg.colors</span><span class="op">[</span><span class="va">edge.regimes</span><span class="op">]</span>, edge.width <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="setup-dataset-and-add-measurement-errors">Setup dataset and add measurement errors<a class="anchor" aria-label="anchor" href="#setup-dataset-and-add-measurement-errors"></a>
</h2>
<p>Now lets set up the variables - including measurement errors. We
could call the data whatever we wanted (e.g “Y_with_error” below), as
long as we combine all the data together into one</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Setup Measurement Errors - for use with blouchOU_reg_direct</span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span>
<span><span class="va">Z_direct</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">Z_X_error</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">Y_with_error</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">mc_log_ant_vol</span></span>
<span><span class="va">X_with_error</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">mc_log_psl</span></span>
<span><span class="va">Y_error</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">me.log_ant_vol</span><span class="op">)</span> <span class="co">#Standard error not variance</span></span>
<span><span class="va">X_error</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">me.log_psl</span><span class="op">)</span> <span class="co">#Standard error not variance</span></span>
<span><span class="va">trdata</span><span class="op">&lt;-</span><span class="va">cervid.trdata.BGS</span></span>
<span><span class="va">regimes_tip</span> <span class="op">&lt;-</span> <span class="va">cervid.trdata.BGS</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span></span></code></pre></div>
<p>Lets add the data to our trdata variable, which already contains the
tree</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################################################################</span></span>
<span><span class="co">#Add errors to trdata file</span></span>
<span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Y_with_error</span>,<span class="va">Y_error</span>,<span class="va">X_with_error</span>,<span class="va">X_error</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-priors">Setting Priors<a class="anchor" aria-label="anchor" href="#setting-priors"></a>
</h2>
<p>Let’s make a simple plot of data, and look at a simple ordinary least
squares regression of Y on X. The intercept and slope values will give
us an idea of how to center our priors below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y_with_error</span>,X<span class="op">=</span><span class="va">X_with_error</span><span class="op">)</span></span>
<span><span class="va">ols.coef</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>,<span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ols.coef</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="co">#Intercept and slope</span></span>
<span><span class="co">#&gt; [1] 0.0444186 6.3044512</span></span>
<span></span>
<span><span class="va">ols.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>,y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">ols.coef</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,slope<span class="op">=</span><span class="va">ols.coef</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ols.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Below are the priors used for this first analysis. See Grabowski (in
press) for more on setting these priors, but here our optima (intercept)
and slope are informed by the linar model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################################################################</span></span>
<span><span class="co">#Set Priors</span></span>
<span><span class="va">hl.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span>,<span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">vy.prior</span><span class="op">&lt;-</span><span class="fl">10</span></span>
<span><span class="va">optima.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.75</span><span class="op">)</span> <span class="co">#Informed by linear model above</span></span>
<span><span class="va">beta.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.304451</span>,<span class="fl">1.75</span><span class="op">)</span> <span class="co">#Informed by linear model above</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-priors">Exploring Priors<a class="anchor" aria-label="anchor" href="#exploring-priors"></a>
</h2>
<p>Lets simulate from our priors to check if these are reasonable values
for the intercept and slope - futher below is code for looking at the
priors for the other parameters in the model, in the prior vs. posterior
plots section. These are the “.sims” values - the priors are based on
the intercept and slope of the OLS regression above, with standard
deviations set by visualizing the priors versus the data.</p>
<p>Half-life Prior plot</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.hl.sims"</span></span>
<span></span>
<span><span class="va">hl.prior.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.hl.sims</span>,fill<span class="op">=</span><span class="st">"prior.hl.sims"</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,data<span class="op">=</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co">#labs(title="Prior vs. Posterior Distribution ",x="Half-life", y = "Density")+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Half-life"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co">#scale_fill_manual(labels=c("Posterior","Prior"))+</span></span>
<span>  <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_fill_npg</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.prior.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Vy Prior Plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.vy.sims"</span></span>
<span></span>
<span><span class="va">vy.prior.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.vy.sims</span>,fill<span class="op">=</span><span class="st">"prior.vy.sims"</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,data<span class="op">=</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co">#labs(title="Prior vs. Posterior Distribution ",x="vy", y = "Density")+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"vy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span></span>
<span>  <span class="co">#scale_fill_manual(labels=c("Posterior","Prior"))+</span></span>
<span>  <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_fill_npg</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">vy.prior.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Prior on how shared branch lengths correspond to covariance</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">a.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span></span>
<span><span class="va">sigma2_y.sims</span><span class="op">&lt;-</span><span class="va">vy.sims</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_npg.html" class="external-link">pal_npg</a></span><span class="op">(</span><span class="st">"nrc"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span><span class="op">&lt;-</span><span class="va">p</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">sigma2_y.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">p</span><span class="op">&lt;-</span><span class="va">p</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Time Since MRCA"</span>, y <span class="op">=</span> <span class="st">"Covariance"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Slope and intercept Prior Plot</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optima.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beta.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_with_error</span>,X<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slope.plot.1</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,x<span class="op">=</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">optima.sims</span>,slope<span class="op">=</span><span class="va">beta.sims</span>,alpha<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span><span class="op">+</span> <span class="co">#Prior</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"X - Direct Effect Model"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_color_npg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slope.plot.1</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="explore-priors---built-in-functions">Explore Priors - built in functions<a class="anchor" aria-label="anchor" href="#explore-priors---built-in-functions"></a>
</h2>
<p>Blouch also contains built in functions to plot the priors, as seen
below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hl.prior.plot.code.html">hl.prior.plot.code</a></span><span class="op">(</span><span class="va">hl.prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vy.prior.plot.code.html">vy.prior.plot.code</a></span><span class="op">(</span><span class="va">vy.prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/covariance.prior.direct.plot.code.html">covariance.prior.direct.plot.code</a></span><span class="op">(</span><span class="va">hl.prior</span>,<span class="va">vy.prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-12-3.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reg.direct.prior.plot.code.html">reg.direct.prior.plot.code</a></span><span class="op">(</span><span class="va">trdata</span>,<span class="va">optima.prior</span>,<span class="va">beta.prior</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-12-4.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="data-setup-for-blouch">Data setup for <em>Blouch</em><a class="anchor" aria-label="anchor" href="#data-setup-for-blouch"></a>
</h2>
<p>The line below combines the existing trdata file from make.trdata
which has regime info for the tips with the X and Y values and their
errors. We will use the helper function blouch.reg.direct.prep() to
setup the dat object for Stan. This function and the other helper
functions included with <em>Blouch</em> require trdata files, and then
the names of the columns that contain Y and (sometimes depending on the
model) X data and error data. “Z_direct” is the number of predictors,
with “BGS” the name of the column where the tip regime data is located.
The rest are the priors we defined above. See help info for each
function and other articles on github.com for functionality.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/blouch.reg.direct.prep.html">blouch.reg.direct.prep</a></span><span class="op">(</span><span class="va">trdata</span>,<span class="st">"Y_with_error"</span>,<span class="st">"Y_error"</span>,<span class="st">"X_with_error"</span>,<span class="st">"X_error"</span>,Z_direct<span class="op">=</span><span class="fl">1</span>,<span class="st">"BGS"</span>,<span class="va">hl.prior</span>,<span class="va">vy.prior</span>,<span class="va">optima.prior</span>,<span class="va">beta.prior</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-models">Running models<a class="anchor" aria-label="anchor" href="#running-models"></a>
</h2>
<p>First we will run the multi-optima direct effect model with varying
intercepts. This will allow our intercepts (optima) to vary with the
regimes, and these results will be similar to those from other OU model
fitting approaches (e.g Slouch).</p>
<p>Now let’s run the model. Stan prints out a lot of info, so lets just
look at the parameter estimates here and store the posterior
distribution for later use.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Combination of regime model with multiple traits direct effect model with measurement error and varying intercepts</span></span>
<span><span class="va">fit.reg.direct</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct</span>,data <span class="op">=</span> <span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>,iter <span class="op">=</span><span class="fl">4000</span><span class="op">)</span></span>
<span><span class="co">#Fig S11 from Grabowski (in press)</span></span></code></pre></div>
<p>Results</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.reg.direct</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Stan model: blouchOU_reg_direct.</span></span>
<span><span class="co">#&gt; 2 chains, each with iter=4000; warmup=2000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=2000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; hl         0.21    0.00 0.05  0.13  0.18  0.21  0.25  0.33  6211    1</span></span>
<span><span class="co">#&gt; vy         0.23    0.00 0.08  0.12  0.18  0.22  0.28  0.41  3375    1</span></span>
<span><span class="co">#&gt; optima[1] -1.01    0.00 0.37 -1.73 -1.26 -1.03 -0.77 -0.25  6215    1</span></span>
<span><span class="co">#&gt; optima[2]  0.23    0.00 0.19 -0.14  0.11  0.23  0.36  0.60  8574    1</span></span>
<span><span class="co">#&gt; optima[3]  0.46    0.00 0.21  0.02  0.33  0.46  0.60  0.88  6478    1</span></span>
<span><span class="co">#&gt; beta[1]    5.01    0.01 0.45  4.14  4.71  5.01  5.30  5.93  5475    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Oct 13 16:36:50 2025.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span><span class="va">post.basic</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct</span><span class="op">)</span></span>
<span><span class="co">#Table S7 from Grabowski (in press)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="priors-vs--posterior-plots-for-multi-optima-direct-effect-model">Priors vs. posterior plots for multi-optima direct effect model<a class="anchor" aria-label="anchor" href="#priors-vs--posterior-plots-for-multi-optima-direct-effect-model"></a>
</h2>
<p>Half-life</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Composite Figures</span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="va">post.basic</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_npg.html" class="external-link">pal_npg</a></span><span class="op">(</span><span class="st">"nrc"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.hl.sims"</span></span>
<span></span>
<span><span class="va">hl.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">hl</span><span class="op">)</span> <span class="co">#Using this model's posterior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.hl.sims"</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hl.sims</span>,<span class="va">hl.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Half-life"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Vy</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.vy.sims"</span></span>
<span></span>
<span><span class="va">vy.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">vy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.vy.sims"</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">vy.sims</span>,<span class="va">vy.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Vy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Covariance</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">a.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span></span>
<span><span class="va">sigma2_y.sims</span><span class="op">&lt;-</span><span class="va">vy.sims</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#mypal &lt;- ggsci::pal_npg("nrc", alpha = 0.4)(2)</span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">sigma2_y.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">post</span><span class="op">$</span><span class="va">sigma2_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Time Since MRCA"</span>, y <span class="op">=</span> <span class="st">"Covariance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>,<span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariance.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Regression plots</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Varying intercepts</span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="va">post.basic</span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html" class="external-link">pal_aaas</a></span><span class="op">(</span><span class="st">"default"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beta.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.post</span><span class="op">&lt;-</span><span class="va">post</span><span class="op">$</span><span class="va">optima</span></span>
<span><span class="va">beta.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"post.beta.1"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.link.11</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.12</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.13</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">x.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span><span class="op">)</span> , length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">mu.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.11</span> <span class="op">)</span></span>
<span><span class="va">mu.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.12</span> <span class="op">)</span></span>
<span><span class="va">mu.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.13</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.11</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.12</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.13</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.11"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.12"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.13"</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.11</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.12</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.13</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_with_error</span>,X<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span>,Regimes<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span></span>
<span><span class="va">df11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.11</span><span class="op">)</span></span>
<span><span class="va">df12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.12</span><span class="op">)</span></span>
<span><span class="va">df13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.13</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regression.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,x<span class="op">=</span><span class="va">X</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Regimes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">optima.sims</span>,slope<span class="op">=</span><span class="va">beta.sims</span>,alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">+</span> <span class="co">#Prior</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.11</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.12</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.13</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Antler Volume (l)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Posterior Skull Length (cm)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Breeding Group \nSize"</span>,values<span class="op">=</span><span class="va">mypal</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1-2'</span>, <span class="st">'3-5'</span>, <span class="st">'&gt;5'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regression.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Label points</span></span></code></pre></div>
<p>Let’s combine all four plots into one plot</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression.plot</span><span class="op">&lt;-</span><span class="va">regression.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">fig</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">hl.plot</span>, <span class="va">vy.plot</span>,<span class="va">covariance.plot</span>,<span class="va">regression.plot</span>,ncol<span class="op">=</span><span class="fl">2</span>,nrow<span class="op">=</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A)"</span>,<span class="st">"B)"</span>,<span class="st">"C)"</span>,<span class="st">"D)"</span><span class="op">)</span>,common.legend <span class="op">=</span> <span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span>
<span><span class="co">#fig&lt;-ggpubr::annotate_figure(fig,top=paste("Multi-Optima Adaptive Model - Varying Effects,\n hl=",hl,sep=""))</span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/FigS11.pdf", plot = fig, width=7, height=7 )</span></span>
<span><span class="va">fig</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="multi-optima-direct-effect-model-with-varying-effects">Multi-optima direct effect model with varying effects<a class="anchor" aria-label="anchor" href="#multi-optima-direct-effect-model-with-varying-effects"></a>
</h2>
<p>Now lets run the multi-optima direct effect model with varying
effects. This will allow our intercepts (optima) and slopes to vary with
the regimes, but does not allow for multilevel modeling. We will use the
same priors and the sane data formatting step above to produce our “dat”
file.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.reg.direct.ve</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct_ve</span>,data <span class="op">=</span> <span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>,iter <span class="op">=</span><span class="fl">4000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#Fig S8 from Grabowski (in press)</span></span></code></pre></div>
<p>Results</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Stan model: blouchOU_reg_direct_ve.</span></span>
<span><span class="co">#&gt; 2 chains, each with iter=4000; warmup=2000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=2000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           mean se_mean   sd  2.5%   25%  50%  75% 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; hl        0.24    0.00 0.06  0.15  0.20 0.24 0.28  0.38  6077    1</span></span>
<span><span class="co">#&gt; vy        0.20    0.00 0.07  0.10  0.15 0.19 0.23  0.36  2905    1</span></span>
<span><span class="co">#&gt; optima[1] 0.17    0.01 0.54 -0.88 -0.20 0.17 0.53  1.27  3925    1</span></span>
<span><span class="co">#&gt; optima[2] 0.26    0.00 0.18 -0.10  0.14 0.26 0.38  0.62  6376    1</span></span>
<span><span class="co">#&gt; optima[3] 0.54    0.00 0.24  0.06  0.39 0.54 0.70  1.01  5197    1</span></span>
<span><span class="co">#&gt; beta[1,1] 7.27    0.01 0.84  5.66  6.71 7.28 7.84  8.92  3898    1</span></span>
<span><span class="co">#&gt; beta[2,1] 4.47    0.01 0.57  3.38  4.09 4.47 4.83  5.63  6250    1</span></span>
<span><span class="co">#&gt; beta[3,1] 4.62    0.01 0.61  3.41  4.21 4.61 5.02  5.82  4746    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Oct 13 16:37:27 2025.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span><span class="va">post.ve</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="priors-vs--posterior-plots-for-multi-optima-direct-effect-model-with-varying-effects">Priors vs. posterior plots for multi-optima direct effect model with
varying effects<a class="anchor" aria-label="anchor" href="#priors-vs--posterior-plots-for-multi-optima-direct-effect-model-with-varying-effects"></a>
</h2>
<p>Lets look at the Prior versus Posterior plots of the parameter
estimates</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Composite Figures</span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="va">post.ve</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_npg.html" class="external-link">pal_npg</a></span><span class="op">(</span><span class="st">"nrc"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.hl.sims"</span></span>
<span></span>
<span><span class="va">hl.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">hl</span><span class="op">)</span> <span class="co">#Using this model's posterior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.hl.sims"</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hl.sims</span>,<span class="va">hl.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Half-life"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Vy</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.vy.sims"</span></span>
<span></span>
<span><span class="va">vy.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">vy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.vy.sims"</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">vy.sims</span>,<span class="va">vy.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Vy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Covariance</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">a.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span></span>
<span><span class="va">sigma2_y.sims</span><span class="op">&lt;-</span><span class="va">vy.sims</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#mypal &lt;- ggsci::pal_npg("nrc", alpha = 0.4)(2)</span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">sigma2_y.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">post</span><span class="op">$</span><span class="va">sigma2_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Time Since MRCA"</span>, y <span class="op">=</span> <span class="st">"Covariance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>,<span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariance.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Now lets look at the varying effects model</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#For Fig. 2</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">$</span><span class="va">X_obs</span></span>
<span><span class="va">Y</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_obs</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html" class="external-link">pal_aaas</a></span><span class="op">(</span><span class="st">"default"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beta.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.post</span><span class="op">&lt;-</span><span class="va">post</span><span class="op">$</span><span class="va">optima</span></span>
<span><span class="va">beta.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"post.beta.1"</span>,<span class="st">"post.beta.2"</span>,<span class="st">"post.beta.3"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.link.11</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.12</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.13</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">x.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> , length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">mu.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.11</span> <span class="op">)</span></span>
<span><span class="va">mu.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.12</span> <span class="op">)</span></span>
<span><span class="va">mu.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.13</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.11</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.12</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.13</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.11"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.12"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.13"</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.11</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.12</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.13</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#df&lt;-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_obs</span>,X<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">X_obs</span>,Regimes<span class="op">=</span><span class="va">regimes_tip</span><span class="op">)</span></span>
<span><span class="va">df11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.11</span><span class="op">)</span></span>
<span><span class="va">df12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.12</span><span class="op">)</span></span>
<span><span class="va">df13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.13</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#slope.prior.plot&lt;-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+</span></span>
<span><span class="va">fig2</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">optima.sims</span>,slope<span class="op">=</span><span class="va">beta.sims</span>,alpha<span class="op">=</span><span class="fl">0.04</span><span class="op">)</span><span class="op">+</span> <span class="co">#Prior</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.11</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.12</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.13</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,x<span class="op">=</span><span class="va">X</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Regimes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Antler Volume (l)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Posterior Skull Length (cm)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Breeding \nGroup Size"</span>,values<span class="op">=</span><span class="va">mypal</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1-2'</span>, <span class="st">'3-5'</span>, <span class="st">'&gt;5'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig2</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/Fig2.pdf", plot = fig2, width=9, height=7 )</span></span></code></pre></div>
<p>Let’s combine all four plots into one plot</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig2</span><span class="op">&lt;-</span><span class="va">fig2</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">fig</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">hl.plot</span>, <span class="va">vy.plot</span>,<span class="va">covariance.plot</span>,<span class="va">fig2</span>,ncol<span class="op">=</span><span class="fl">2</span>,nrow<span class="op">=</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A)"</span>,<span class="st">"B)"</span>,<span class="st">"C)"</span>,<span class="st">"D)"</span><span class="op">)</span>,common.legend <span class="op">=</span> <span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/FigS8.pdf", plot = fig, width=7, height=7 )</span></span>
<span><span class="va">fig</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="multilevel-models">Multilevel Models<a class="anchor" aria-label="anchor" href="#multilevel-models"></a>
</h2>
<p>Now let’s run the multilevel version of those two models. As a
multilevel model, information can be shared across the regimes, which
can produce more accurate parameter estimates. Below are the priors used
for this simulation. Here we use the non-centered version to aid in ease
of calculation. See Grabowski (in press) for more on non-centered
models. We will compare these all models in terms of their predictive
performance at the end.</p>
<p>Below are the priors used for this first analysis. See Grabowski (in
press) for more on setting these priors. The only new prior is on
sigma</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################################################################</span></span>
<span><span class="co">#Set Priors</span></span>
<span><span class="va">hl.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span>,<span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">vy.prior</span><span class="op">&lt;-</span><span class="fl">10</span></span>
<span><span class="va">optima.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.75</span><span class="op">)</span> <span class="co">#Informed by linear model</span></span>
<span><span class="va">beta.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.304451</span>,<span class="fl">1.75</span><span class="op">)</span> <span class="co">#Informed by linear model</span></span>
<span><span class="va">sigma.prior</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multilevel-multi-optima-direct-effect-model-with-varying-intercepts">Multilevel Multi-Optima Direct Effect Model with Varying
Intercepts<a class="anchor" aria-label="anchor" href="#multilevel-multi-optima-direct-effect-model-with-varying-intercepts"></a>
</h2>
<p>First we will run the multilevel multi-optima direct effect model
with varying intercepts, which is non-centered for ease of
estimation.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/blouch.reg.direct.mlm.prep.html">blouch.reg.direct.mlm.prep</a></span><span class="op">(</span><span class="va">trdata</span>,<span class="st">"Y_with_error"</span>,<span class="st">"Y_error"</span>,<span class="st">"X_with_error"</span>,<span class="st">"X_error"</span>,Z_direct<span class="op">=</span><span class="fl">1</span>,<span class="st">"BGS"</span>,<span class="va">hl.prior</span>,<span class="va">vy.prior</span>,<span class="va">optima.prior</span>,<span class="va">beta.prior</span>,<span class="va">sigma.prior</span><span class="op">)</span></span></code></pre></div>
<p>Fit the model</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.reg.direct.mlm.vi.nc</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct_mlm_vi_nc</span>,data <span class="op">=</span> <span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>,iter <span class="op">=</span><span class="fl">4000</span>,control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span></span>
<span><span class="co">#Fig S10/Table S6 in Grabowski (in press)</span></span></code></pre></div>
<p>Let’s check out the results</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.vi.nc</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"optima_bar"</span>,<span class="st">"beta"</span>,<span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Stan model: blouchOU_reg_direct_mlm_vi_nc.</span></span>
<span><span class="co">#&gt; 2 chains, each with iter=4000; warmup=2000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=2000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; hl          0.22    0.00 0.06  0.13  0.18  0.21  0.25  0.34  4438    1</span></span>
<span><span class="co">#&gt; vy          0.24    0.00 0.08  0.12  0.18  0.23  0.28  0.43  2102    1</span></span>
<span><span class="co">#&gt; optima[1]  -1.00    0.01 0.45 -1.86 -1.31 -1.01 -0.73 -0.03  1706    1</span></span>
<span><span class="co">#&gt; optima[2]   0.22    0.00 0.19 -0.17  0.09  0.22  0.34  0.59  4328    1</span></span>
<span><span class="co">#&gt; optima[3]   0.45    0.00 0.23 -0.02  0.30  0.46  0.60  0.88  3139    1</span></span>
<span><span class="co">#&gt; optima_bar -0.04    0.01 0.43 -0.93 -0.31 -0.04  0.22  0.82  1769    1</span></span>
<span><span class="co">#&gt; beta[1]     5.03    0.01 0.48  4.14  4.69  5.02  5.36  6.01  1986    1</span></span>
<span><span class="co">#&gt; sigma       0.91    0.01 0.44  0.19  0.60  0.84  1.15  1.92  1800    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Oct 13 16:38:46 2025.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span><span class="va">post.mlm.vi</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.vi.nc</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="priors-vs--posterior-plots-for-multilevel-multi-optima-direct-effect-model-with-varying-intercepts">Priors vs. posterior plots for multilevel multi-optima direct effect
model with varying intercepts<a class="anchor" aria-label="anchor" href="#priors-vs--posterior-plots-for-multilevel-multi-optima-direct-effect-model-with-varying-intercepts"></a>
</h2>
<p>Lets look at the Prior versus Posterior plots of the parameter
estimates Half-life</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Composite Figures</span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="va">post.mlm.vi</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_npg.html" class="external-link">pal_npg</a></span><span class="op">(</span><span class="st">"nrc"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.hl.sims"</span></span>
<span></span>
<span><span class="va">hl.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">hl</span><span class="op">)</span> <span class="co">#Using this model's posterior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.hl.sims"</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hl.sims</span>,<span class="va">hl.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Half-life"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>Vy</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.vy.sims"</span></span>
<span></span>
<span><span class="va">vy.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">vy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.vy.sims"</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">vy.sims</span>,<span class="va">vy.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Vy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>Covariance</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">a.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span></span>
<span><span class="va">sigma2_y.sims</span><span class="op">&lt;-</span><span class="va">vy.sims</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#mypal &lt;- ggsci::pal_npg("nrc", alpha = 0.4)(2)</span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">sigma2_y.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">post</span><span class="op">$</span><span class="va">sigma2_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Time Since MRCA"</span>, y <span class="op">=</span> <span class="st">"Covariance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>,<span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariance.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>Regression Plots</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Varying intercepts</span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html" class="external-link">pal_aaas</a></span><span class="op">(</span><span class="st">"default"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beta.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.post</span><span class="op">&lt;-</span><span class="va">post</span><span class="op">$</span><span class="va">optima</span></span>
<span><span class="va">beta.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"post.beta.1"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.link.11</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.12</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.13</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">x.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span><span class="op">)</span> , length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">mu.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.11</span> <span class="op">)</span></span>
<span><span class="va">mu.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.12</span> <span class="op">)</span></span>
<span><span class="va">mu.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.13</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.11</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.12</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.13</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.11"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.12"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.13"</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.11</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.12</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.13</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_with_error</span>,X<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">X_with_error</span>,Regimes<span class="op">=</span><span class="va">trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">BGS</span><span class="op">)</span></span>
<span><span class="va">df11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.11</span><span class="op">)</span></span>
<span><span class="va">df12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.12</span><span class="op">)</span></span>
<span><span class="va">df13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.13</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regression.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,x<span class="op">=</span><span class="va">X</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Regimes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">optima.sims</span>,slope<span class="op">=</span><span class="va">beta.sims</span>,alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">+</span> <span class="co">#Prior</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.11</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.12</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.13</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Antler Volume (l)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Posterior Skull Length (cm)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Breeding Group \nSize"</span>,values<span class="op">=</span><span class="va">mypal</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1-2'</span>, <span class="st">'3-5'</span>, <span class="st">'&gt;5'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regression.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Label points</span></span></code></pre></div>
<p>Let’s combine all four plots into one plot</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig2</span><span class="op">&lt;-</span><span class="va">fig2</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">fig</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">hl.plot</span>, <span class="va">vy.plot</span>,<span class="va">covariance.plot</span>,<span class="va">regression.plot</span>,ncol<span class="op">=</span><span class="fl">2</span>,nrow<span class="op">=</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A)"</span>,<span class="st">"B)"</span>,<span class="st">"C)"</span>,<span class="st">"D)"</span><span class="op">)</span>,common.legend <span class="op">=</span> <span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/FigS10.pdf", plot = fig, width=7, height=7 )</span></span>
<span><span class="va">fig</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="multilevel-multi-optima-direct-effect-model-with-varying-effects">Multilevel Multi-Optima Direct Effect Model with Varying
Effects<a class="anchor" aria-label="anchor" href="#multilevel-multi-optima-direct-effect-model-with-varying-effects"></a>
</h2>
<p>Now let’s run the Multilevel Multi-optima Direct Effect Model with
Varying Effects. This will allow our intercepts (optima) and slopes to
vary with the regimes. As a multilevel model, information can be shared
across the regimes, which can produce more accurate parameter
estimates.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.reg.direct.mlm.ve.nc</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct_mlm_ve_nc</span>,data <span class="op">=</span> <span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>,iter <span class="op">=</span><span class="fl">4000</span>,control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span></code></pre></div>
<p>Results</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.ve.nc</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima_bar"</span>,<span class="st">"beta_bar"</span>,<span class="st">"Rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Stan model: blouchOU_reg_direct_mlm_ve_nc.</span></span>
<span><span class="co">#&gt; 2 chains, each with iter=4000; warmup=2000; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=2000, total post-warmup draws=4000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             mean se_mean   sd  2.5%   25%   50%  75% 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; hl          0.24    0.00 0.06  0.14  0.19  0.23 0.27  0.37  6052    1</span></span>
<span><span class="co">#&gt; vy          0.20    0.00 0.07  0.10  0.15  0.19 0.24  0.37  2774    1</span></span>
<span><span class="co">#&gt; optima_bar  0.25    0.01 0.33 -0.53  0.08  0.28 0.45  0.85  2409    1</span></span>
<span><span class="co">#&gt; beta_bar    5.55    0.02 0.82  3.97  5.00  5.53 6.05  7.18  2853    1</span></span>
<span><span class="co">#&gt; Rho[1,2]   -0.06    0.00 0.33 -0.68 -0.31 -0.07 0.17  0.57  5343    1</span></span>
<span><span class="co">#&gt; sigma[1]    0.46    0.01 0.39  0.02  0.17  0.36 0.64  1.45  2067    1</span></span>
<span><span class="co">#&gt; sigma[2]    1.28    0.01 0.55  0.17  0.91  1.25 1.62  2.41  1897    1</span></span>
<span><span class="co">#&gt; optima[1]   0.05    0.01 0.54 -1.20 -0.25  0.17 0.40  0.93  1902    1</span></span>
<span><span class="co">#&gt; optima[2]   0.29    0.00 0.17 -0.07  0.18  0.30 0.41  0.62  4506    1</span></span>
<span><span class="co">#&gt; optima[3]   0.47    0.00 0.21  0.07  0.33  0.46 0.61  0.91  4094    1</span></span>
<span><span class="co">#&gt; beta[1,1]   6.93    0.02 0.91  4.96  6.39  7.03 7.54  8.56  1828    1</span></span>
<span><span class="co">#&gt; beta[2,1]   4.53    0.01 0.58  3.47  4.14  4.52 4.92  5.68  3552    1</span></span>
<span><span class="co">#&gt; beta[3,1]   4.75    0.01 0.58  3.59  4.37  4.75 5.14  5.87  3529    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Oct 13 16:40:40 2025.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span>
<span><span class="va">post.mlm.ve</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.ve.nc</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="priors-vs--posterior-plots-for-multilevel-multi-optima-direct-effect-model-with-varying-effects">Priors vs. posterior plots for multilevel multi-optima direct effect
model with varying effects<a class="anchor" aria-label="anchor" href="#priors-vs--posterior-plots-for-multilevel-multi-optima-direct-effect-model-with-varying-effects"></a>
</h2>
<p>Lets look at the Prior versus Posterior plots of the parameter
estimates Half-life</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Composite Figures</span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="va">post.mlm.ve</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_npg.html" class="external-link">pal_npg</a></span><span class="op">(</span><span class="st">"nrc"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.hl.sims"</span></span>
<span></span>
<span><span class="va">hl.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">hl</span><span class="op">)</span> <span class="co">#Using this model's posterior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.hl.sims"</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hl.sims</span>,<span class="va">hl.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.hl.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Half-life"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>Vy</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.sims</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"prior.vy.sims"</span></span>
<span></span>
<span><span class="va">vy.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">vy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vy.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"post.vy.sims"</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">vy.sims</span>,<span class="va">vy.post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prior.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">post.vy.sims</span>, fill<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Vy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#ggsci::scale_fill_npg(name="",labels=c("Posterior","Prior"))</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vy.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>Covariance</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="va">hl.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,meanlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sdlog<span class="op">=</span><span class="va">hl.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vy.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,rate<span class="op">=</span><span class="va">vy.prior</span><span class="op">)</span></span>
<span><span class="va">a.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span></span>
<span><span class="va">sigma2_y.sims</span><span class="op">&lt;-</span><span class="va">vy.sims</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">hl.sims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#mypal &lt;- ggsci::pal_npg("nrc", alpha = 0.4)(2)</span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">sigma2_y.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">a.sims</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">post</span><span class="op">$</span><span class="va">sigma2_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">post</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                              args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i<span class="op">=</span><span class="va">i</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,lwd<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">covariance.plot</span><span class="op">&lt;-</span><span class="va">covariance.plot</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="st">"Time Since MRCA"</span>, y <span class="op">=</span> <span class="st">"Covariance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">mypal</span>,name<span class="op">=</span><span class="st">""</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>,<span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariance.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>Regression Plots</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#For Fig. 3</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">$</span><span class="va">X_obs</span></span>
<span><span class="va">Y</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_obs</span></span>
<span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html" class="external-link">pal_aaas</a></span><span class="op">(</span><span class="st">"default"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">optima.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beta.sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">beta.prior</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optima.post</span><span class="op">&lt;-</span><span class="va">post</span><span class="op">$</span><span class="va">optima</span></span>
<span><span class="va">beta.post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta.post</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"post.beta.1"</span>,<span class="st">"post.beta.2"</span>,<span class="st">"post.beta.3"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.link.11</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.12</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">}</span></span>
<span><span class="va">mu.link.13</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x.seq</span><span class="op">)</span><span class="op">{</span><span class="va">optima.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">x.seq</span><span class="op">*</span><span class="va">beta.post</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">x.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> , length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">mu.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.11</span> <span class="op">)</span></span>
<span><span class="va">mu.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.12</span> <span class="op">)</span></span>
<span><span class="va">mu.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x.seq</span> , <span class="va">mu.link.13</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.11</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.12</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mu.13</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.mean.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu.mean.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.11"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.12"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.mean.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"mu.mean.13"</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.11</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.12</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span><span class="va">mu.CI.13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">mu.13</span> , MARGIN<span class="op">=</span><span class="fl">2</span>, FUN<span class="op">=</span><span class="fu">rethinking</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span> , prob<span class="op">=</span><span class="fl">0.89</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mu.CI.11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span><span class="va">mu.CI.13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">)</span>,<span class="va">x.seq</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.11</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.12</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mu.CI.13</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.5.5"</span>,<span class="st">"max.94.5"</span>,<span class="st">"x.seq"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#df&lt;-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_obs</span>,X<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">X_obs</span>,Regimes<span class="op">=</span><span class="va">regimes_tip</span><span class="op">)</span></span>
<span><span class="va">df11</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.11</span><span class="op">)</span></span>
<span><span class="va">df12</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.12</span><span class="op">)</span></span>
<span><span class="va">df13</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x.seq</span>,<span class="va">mu.mean.13</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#slope.prior.plot&lt;-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+</span></span>
<span><span class="va">regression.plot</span><span class="op">&lt;-</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">optima.sims</span>,slope<span class="op">=</span><span class="va">beta.sims</span>,alpha<span class="op">=</span><span class="fl">0.04</span><span class="op">)</span><span class="op">+</span> <span class="co">#Prior</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df11</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.11</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df12</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.12</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mu.CI.13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,ymin<span class="op">=</span><span class="va">min.5.5</span>,ymax<span class="op">=</span><span class="va">max.94.5</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df13</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.seq</span>,y<span class="op">=</span><span class="va">mu.mean.13</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fl">1</span>,linewidth<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,color<span class="op">=</span><span class="va">mypal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,x<span class="op">=</span><span class="va">X</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Regimes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Antler Volume (l)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Posterior Skull Length (cm)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Breeding \nGroup Size"</span>,values<span class="op">=</span><span class="va">mypal</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1-2'</span>, <span class="st">'3-5'</span>, <span class="st">'&gt;5'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regression.plot</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Fig 3 in Grabowski (in press)</span></span></code></pre></div>
<p>Let’s combine all four plots into one plot</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig2</span><span class="op">&lt;-</span><span class="va">fig2</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">fig</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">hl.plot</span>, <span class="va">vy.plot</span>,<span class="va">covariance.plot</span>,<span class="va">regression.plot</span>,ncol<span class="op">=</span><span class="fl">2</span>,nrow<span class="op">=</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A)"</span>,<span class="st">"B)"</span>,<span class="st">"C)"</span>,<span class="st">"D)"</span><span class="op">)</span>,common.legend <span class="op">=</span> <span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/FigS9.pdf", plot = fig, width=7, height=7 )</span></span>
<span><span class="va">fig</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="model-comparison-using-psis">Model Comparison using PSIS<a class="anchor" aria-label="anchor" href="#model-comparison-using-psis"></a>
</h2>
<p>Lets do some model comparison using Pareto-Smoothed Importance
Sampling (PSIS) from the R Package <em>loo</em> (Vehtari et al. 2023).
loo estimates leave-one-out cross-validation for Bayesian analyses. Here
we are looking for Pareto k values below ~0.7, which suggest the results
are an accurate estimation of cross-validation. PSIS also provides a way
to look at outliers in our analysis.</p>
<p>We then compare the two models using the loo_compare function from
the same package.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; null device </span></span>
<span><span class="co">#&gt;           1</span></span>
<span><span class="va">old.par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">old.par</span><span class="op">)</span></span>
<span></span>
<span><span class="co">############################################################################################################</span></span>
<span><span class="va">loo_mlm_ve_nc</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.ve.nc</span>, cores <span class="op">=</span> <span class="fl">2</span>, save_psis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some Pareto k diagnostic values are too high. See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo_mlm_ve_nc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 30 log-likelihood matrix.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate  SE</span></span>
<span><span class="co">#&gt; elpd_loo    -26.1 4.4</span></span>
<span><span class="co">#&gt; p_loo        14.3 2.8</span></span>
<span><span class="co">#&gt; looic        52.3 8.8</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; MCSE of elpd_loo is NA.</span></span>
<span><span class="co">#&gt; MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 1.7]).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pareto k diagnostic values:</span></span>
<span><span class="co">#&gt;                          Count Pct.    Min. ESS</span></span>
<span><span class="co">#&gt; (-Inf, 0.7]   (good)     24    80.0%   128     </span></span>
<span><span class="co">#&gt;    (0.7, 1]   (bad)       5    16.7%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt;    (1, Inf)   (very bad)  1     3.3%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_mlm_ve_nc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_mlm_ve_nc</span>,label_points<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#library(loo) #Non-mlm varying effects model</span></span>
<span><span class="va">loo_ve</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve</span>, cores <span class="op">=</span> <span class="fl">2</span>, save_psis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some Pareto k diagnostic values are too high. See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo_ve</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 30 log-likelihood matrix.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate  SE</span></span>
<span><span class="co">#&gt; elpd_loo    -25.4 4.0</span></span>
<span><span class="co">#&gt; p_loo        13.8 2.4</span></span>
<span><span class="co">#&gt; looic        50.7 8.1</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; MCSE of elpd_loo is NA.</span></span>
<span><span class="co">#&gt; MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.9]).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pareto k diagnostic values:</span></span>
<span><span class="co">#&gt;                          Count Pct.    Min. ESS</span></span>
<span><span class="co">#&gt; (-Inf, 0.7]   (good)     20    66.7%   398     </span></span>
<span><span class="co">#&gt;    (0.7, 1]   (bad)      10    33.3%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt;    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_ve</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_ve</span>,label_points<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#library(loo) #MLM Varying intercepts model</span></span>
<span><span class="va">loo_mlm_vi_nc</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.vi.nc</span>, cores <span class="op">=</span> <span class="fl">2</span>, save_psis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some Pareto k diagnostic values are too high. See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo_mlm_vi_nc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 30 log-likelihood matrix.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate   SE</span></span>
<span><span class="co">#&gt; elpd_loo    -28.3  5.5</span></span>
<span><span class="co">#&gt; p_loo        12.8  3.4</span></span>
<span><span class="co">#&gt; looic        56.5 10.9</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; MCSE of elpd_loo is NA.</span></span>
<span><span class="co">#&gt; MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.5]).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pareto k diagnostic values:</span></span>
<span><span class="co">#&gt;                          Count Pct.    Min. ESS</span></span>
<span><span class="co">#&gt; (-Inf, 0.7]   (good)     26    86.7%   283     </span></span>
<span><span class="co">#&gt;    (0.7, 1]   (bad)       4    13.3%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt;    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_mlm_vi_nc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_mlm_vi_nc</span>,label_points<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#library(loo) #Basic model</span></span>
<span><span class="va">loo_basic</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></span><span class="op">(</span><span class="va">fit.reg.direct</span>, cores <span class="op">=</span> <span class="fl">2</span>, save_psis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some Pareto k diagnostic values are too high. See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo_basic</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 4000 by 30 log-likelihood matrix.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate   SE</span></span>
<span><span class="co">#&gt; elpd_loo    -28.7  5.4</span></span>
<span><span class="co">#&gt; p_loo        13.5  3.5</span></span>
<span><span class="co">#&gt; looic        57.3 10.9</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; MCSE of elpd_loo is NA.</span></span>
<span><span class="co">#&gt; MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 2.1]).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pareto k diagnostic values:</span></span>
<span><span class="co">#&gt;                          Count Pct.    Min. ESS</span></span>
<span><span class="co">#&gt; (-Inf, 0.7]   (good)     24    80.0%   547     </span></span>
<span><span class="co">#&gt;    (0.7, 1]   (bad)       4    13.3%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt;    (1, Inf)   (very bad)  2     6.7%   &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_basic</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loo_basic</span>,label_points<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">loo_mlm_ve_nc</span>, <span class="va">loo_ve</span>, <span class="va">loo_mlm_vi_nc</span>, <span class="va">loo_basic</span><span class="op">)</span></span>
<span><span class="co">#&gt;        elpd_diff se_diff</span></span>
<span><span class="co">#&gt; model2  0.0       0.0   </span></span>
<span><span class="co">#&gt; model1 -0.8       0.9   </span></span>
<span><span class="co">#&gt; model3 -2.9       3.6   </span></span>
<span><span class="co">#&gt; model4 -3.3       3.5</span></span>
<span><span class="fl">2.6</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">3.3</span><span class="op">*</span><span class="fl">1.86</span> <span class="co">#95% interval of the difference, z-score of 1.86</span></span>
<span><span class="co">#&gt; [1] -3.538  8.738</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-comparison-using-bayes-factors">Model Comparison using Bayes Factors<a class="anchor" aria-label="anchor" href="#model-comparison-using-bayes-factors"></a>
</h2>
<p>Now lets compare our two models using Bayes Factors. Here we use the
<em>bridgesampling</em> R package (Gronau et al. 2020). Looking below,
we can read the results as the data is X times more likely under a model
that assumes the first mode rather than second model.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################################################################</span></span>
<span><span class="va">lml.fit.reg.direct.mlm.ve.nc</span><span class="op">&lt;-</span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.ve.nc</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lml.fit.reg.direct.mlm.vi.nc</span><span class="op">&lt;-</span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.vi.nc</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lml.fit.reg.direct.ve</span><span class="op">&lt;-</span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lml.fit.reg.direct</span><span class="op">&lt;-</span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.reg.direct</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#bridgesampling::bf(lml.fit.reg.direct.mlm.ve, lml.fit.reg.direct.mlm.ve.nc)</span></span>
<span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bf.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">lml.fit.reg.direct.ve</span>, <span class="va">lml.fit.reg.direct.mlm.ve.nc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Bayes factor in favor of lml.fit.reg.direct.ve over lml.fit.reg.direct.mlm.ve.nc: 14.04240</span></span>
<span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bf.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">lml.fit.reg.direct.ve</span>, <span class="va">lml.fit.reg.direct.mlm.vi.nc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Bayes factor in favor of lml.fit.reg.direct.ve over lml.fit.reg.direct.mlm.vi.nc: 66.57633</span></span>
<span><span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bf.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">lml.fit.reg.direct.ve</span>, <span class="va">lml.fit.reg.direct</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Bayes factor in favor of lml.fit.reg.direct.ve over lml.fit.reg.direct: 9.89876</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trace-for-estimated-parameters">Trace for estimated parameters<a class="anchor" aria-label="anchor" href="#trace-for-estimated-parameters"></a>
</h2>
<p>Let’s look at traceplots of our models, which give a visualization of
degree of convergence.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################################################################</span></span>
<span><span class="co">#Trankplots/Traceplots 4X10</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.ve.nc</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima_bar"</span>,<span class="st">"beta_bar"</span>,<span class="st">"Rho"</span>,<span class="st">"sigma"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-40-2.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.reg.direct.mlm.vi.nc</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"optima_bar"</span>,<span class="st">"beta"</span>,<span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-40-3.png" width="700"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.reg.direct</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hl"</span>,<span class="st">"vy"</span>,<span class="st">"optima"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-40-4.png" width="700"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#plot.emp.ve&lt;-rstan::traceplot(fit.reg.direct.ve,pars = c("hl","vy","optima","beta"))</span></span>
<span><span class="co">#plot.emp.mlm.ve&lt;-rstan::traceplot(fit.reg.direct.mlm.ve.nc,pars = c("hl","vy","optima_bar","beta_bar","Rho","sigma","optima","beta"))</span></span>
<span><span class="co">#plot.emp.vi&lt;-rstan::traceplot(fit.reg.direct.ve,pars = c("hl","vy","optima","beta"))</span></span>
<span><span class="co">#plot.emp.mlm.vi&lt;-rstan::traceplot(fit.reg.direct.mlm.ve.nc,pars = c("hl","vy","optima","optima_bar","beta","sigma"))</span></span>
<span></span>
<span><span class="co">#fig&lt;-ggpubr::ggarrange(plot.emp.vi, plot.emp.ve,plot.emp.mlm.vi,plot.emp.mlm.ve,ncol=2,nrow=2, labels = c("A)","B)","C)","D)"),common.legend = TRUE,legend="top")</span></span>
<span><span class="co">#fig&lt;-ggpubr::annotate_figure(fig,top=paste("Multi-Optima Direct Effect - Varying Effects, hl=",hl,sep=""))</span></span>
<span><span class="co">#ggplot2::ggsave("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch Project - SBR2/Blouch ms/R2/Figures/FigS6.pdf", plot = fig, width=9, height=9)</span></span>
<span><span class="co">########################################################################################################</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compare-posterior-distributions">Compare posterior distributions<a class="anchor" aria-label="anchor" href="#compare-posterior-distributions"></a>
</h2>
<p>Now that we have our best model, lets compare the posterior
distributions of slopes and other usuful stats</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">########################################################################################################</span></span>
<span><span class="co">#Compare slopes</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">post.ve</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.804006</span></span>
<span><span class="fu">rethinking</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,prob<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt;        3%       98% </span></span>
<span><span class="co">#&gt; 0.8444567 4.8495448</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fl">4000</span></span>
<span><span class="co">#&gt; [1] 0.00325</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fl">4000</span></span>
<span><span class="co">#&gt; [1] 0.99675</span></span>
<span></span>
<span><span class="va">unscaled.hl</span><span class="op">&lt;-</span><span class="va">post.ve</span><span class="op">$</span><span class="va">hl</span><span class="op">*</span><span class="va">l.tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">unscaled.hl</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.407361</span></span>
<span><span class="fu">rethinking</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rethinking/man/HPDI.html" class="external-link">PI</a></span><span class="op">(</span><span class="va">unscaled.hl</span>,prob<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt;       3%      98% </span></span>
<span><span class="co">#&gt; 2.055231 5.356274</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="predictive-checks">Predictive Checks<a class="anchor" aria-label="anchor" href="#predictive-checks"></a>
</h2>
<p>Now lets run prior and posterior predictive checks for our two
models. Prior predictive checks generate predictions from the model
using only the prior distributions in order to assess whether the priors
are appropriate – they are equivalent to running the model without data
(Gabry et al. 2019). Posterior predictive checks generate data according
to the posterior predictive distribution and compare it to the observed
data to assess the fit of the model (Gabry et al. 2019). <em>Blouch</em>
includes Stan functions to run prior and posterior predictive checks for
each of the included models and their use is demonstrated below in the
simulation and empirical examples.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/blouch.reg.direct.prep.html">blouch.reg.direct.prep</a></span><span class="op">(</span><span class="va">trdata</span>,<span class="st">"Y_with_error"</span>,<span class="st">"Y_error"</span>,<span class="st">"X_with_error"</span>,<span class="st">"X_error"</span>,Z_direct<span class="op">=</span><span class="fl">1</span>,<span class="st">"BGS"</span>,<span class="va">hl.prior</span>,<span class="va">vy.prior</span>,<span class="va">optima.prior</span>,<span class="va">beta.prior</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.reg.direct.ve.priorpc</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct_ve_priorpc</span>,data<span class="op">=</span><span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>, iter <span class="op">=</span><span class="fl">2000</span>,algorithm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fixed_param"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve.priorpc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">num.plots</span><span class="op">&lt;-</span><span class="fl">5</span></span>
<span><span class="va">plots</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ysim.ppc.plot.code.html">ysim.ppc.plot.code</a></span><span class="op">(</span><span class="va">dat</span>,<span class="va">post</span>,<span class="fl">1</span><span class="op">:</span><span class="va">num.plots</span><span class="op">)</span></span>
<span><span class="va">plots</span><span class="op">&lt;-</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs<span class="op">=</span><span class="va">plots</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">1</span>,common.legend<span class="op">=</span><span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-42-1.png" width="700"></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tgrob</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html" class="external-link">text_grob</a></span><span class="op">(</span><span class="st">"Multi-Optima Direct Effect Model - Varying Efects - Prior PC"</span>,size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">plots.prior</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html" class="external-link">annotate_figure</a></span><span class="op">(</span><span class="va">plots</span>,top<span class="op">=</span><span class="va">tgrob</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.reg.direct.ve.postpc</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu">blouch</span><span class="fu">:::</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOU_reg_direct_ve_postpc</span>,data<span class="op">=</span><span class="va">dat</span>,chains <span class="op">=</span> <span class="fl">2</span>,cores<span class="op">=</span><span class="fl">2</span>, iter <span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span><span class="co">#&gt; Found more than one class "stanfit" in cache; using the first, from namespace 'rstan'</span></span>
<span><span class="co">#&gt; Also defined by 'rethinking'</span></span>
<span></span>
<span></span>
<span><span class="va">post</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.reg.direct.ve.postpc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">num.plots</span><span class="op">&lt;-</span><span class="fl">5</span></span>
<span><span class="va">plots</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ysim.ppc.plot.code.html">ysim.ppc.plot.code</a></span><span class="op">(</span><span class="va">dat</span>,<span class="va">post</span>,<span class="fl">1</span><span class="op">:</span><span class="va">num.plots</span><span class="op">)</span></span>
<span><span class="va">plots</span><span class="op">&lt;-</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs<span class="op">=</span><span class="va">plots</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">1</span>,common.legend<span class="op">=</span><span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-42-2.png" width="700"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tgrob</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html" class="external-link">text_grob</a></span><span class="op">(</span><span class="st">"Multi-Optima Direct Effect Model - Varying Efects - Posterior PC"</span>,size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">plots.post</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html" class="external-link">annotate_figure</a></span><span class="op">(</span><span class="va">plots</span>,top<span class="op">=</span><span class="va">tgrob</span><span class="op">)</span></span>
<span><span class="va">fig</span><span class="op">&lt;-</span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">plots.prior</span>, <span class="va">plots.post</span>,ncol<span class="op">=</span><span class="fl">1</span>,nrow<span class="op">=</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C)"</span>,<span class="st">"D)"</span><span class="op">)</span>,common.legend <span class="op">=</span> <span class="cn">TRUE</span>,legend<span class="op">=</span><span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots.prior</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-42-3.png" width="700"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots.post</span></span></code></pre></div>
<p><img src="Empirical-Example_files/figure-html/unnamed-chunk-42-4.png" width="700"></p>
<p>Posterior predictive checks show that the model is well fit as it
generates data that are a close approximation of the true dataset.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Pagel, M (1994) Detecting correlated evolution on phylogenies: a
general method for the comparative analysis of discrete characters.
Proceedings of the Royal Society of London. Series B. Biological
Sciences, 255, 37–445.</p>
<p>Tsuboi M., Kopperud B.T., Matschiner M., Grabowski M., Syrowatka C.,
Pélabon C., Hansen T.F. 2024. Antler Allometry, the Irish Elk and Gould
Revisited. Evol Biol.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Grabowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
