"0","n<-length(trdata$phy$tip.label)"
"0","mrca1 <- ape::mrca(trdata$phy)"
"0","times <- ape::node.depth.edgelength(trdata$phy)"
"0","ta <- matrix(times[mrca1], nrow=n, dimnames = list(trdata$phy$tip.label, trdata$phy$tip.label))"
"0","T.term <- times[1:n]"
"0","tia <- times[1:n] - ta"
"0","tja <- t(tia)"
"0","tij <- tja + tia"
"0",""
"0","regimes_internal <-trdata$phy$node.label"
"0","regimes_tip <- trdata$dat$regimes"
"0","regimes <- concat.factor(regimes_tip, regimes_internal)"
"0","anc_maps<-""regimes"""
"0","lineages <- lapply(1:n, function(e) lineage.constructor(trdata$phy, e, anc_maps, regimes, ace)) #Trace lineage from tips (n) to root and determine regimes of each node or branch"
"0",""
"0",""
